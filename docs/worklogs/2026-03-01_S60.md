# Session 60 — 2026-03-01

## Context
- **Phase**: Phase 3 — Partial Observability & Self-Play
- **Prior**: S59 implemented LOS partial obs, launched S1v3. SP3 showed single-strategy failure. S1v3 plateaued at 56% (symmetric LOS worse than full obs).

## Objectives
- [ ] Implement asymmetric LOS masking (pursuer-only) in `pursuit_evasion_env.py`
- [ ] Implement randomized obstacle count (1-2) per episode
- [ ] Update all scripts (train_evader_vs_greedy, train_amsdrl, visualize_grid_gif)
- [ ] Add tests for new features
- [ ] Push code for S1v4a/S1v4b launch on niro-2

## Work Done

### 1. Asymmetric Obs + Randomized Obstacles in PursuitEvasionEnv
- Added `n_obstacles_min`, `n_obstacles_max`, `asymmetric_obs` params to `__init__()`
- Modified `reset()` to randomize obstacle count when min/max are set
- Modified `_get_obs()` for per-agent LOS masking (evader sees through when asymmetric)

### 2. Script Updates
- `train_evader_vs_greedy.py`: New CLI args, env_kwargs, banner update
- `train_amsdrl.py`: New CLI args, pass-through to AMSDRLSelfPlay
- `training/amsdrl.py`: New params in `_make_partial_obs_env()`, `AMSDRLSelfPlay.__init__()`, env_kwargs
- `visualize_grid_gif.py`: New CLI args, env_kwargs

### 3. Tests
- 5 new tests in `TestPartialObsLOS` class

## Files Changed
| File | Action | Description |
|------|--------|-------------|
| `envs/pursuit_evasion_env.py` | Modified | Randomized obstacles, asymmetric obs |
| `scripts/train_evader_vs_greedy.py` | Modified | New CLI args |
| `scripts/train_amsdrl.py` | Modified | New CLI args |
| `training/amsdrl.py` | Modified | Pass-through params |
| `scripts/visualize_grid_gif.py` | Modified | New CLI args |
| `tests/test_env.py` | Modified | 5 new tests |

## Decisions Made
| Decision | Rationale |
|----------|-----------|
| Asymmetric obs only masks pursuer | Evader needs full info to strategically hide; pursuer being blind creates information asymmetry |
| Randomized 1-2 obstacles | Forces environment-adaptive behavior, prevents rote obstacle-hugging |
| n_obstacle_obs = n_obstacles_max | Fixed obs dim even when actual count varies |

## Issues & Blockers
| Issue | Resolution |
|-------|------------|
| None yet | - |

## Next Steps
- [ ] Launch S1v4a (asymmetric + randomized) on niro-2
- [ ] Launch S1v4b (symmetric + randomized) on niro-2
- [ ] Monitor escape rate curves, compare asymmetric vs symmetric
