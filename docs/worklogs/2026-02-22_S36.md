# Session 36 — 2026-02-22

## Context
- **Phase**: Pre-Phase 3 — Expert Specification Panel Review & Fixes
- **Branch**: N/A (documentation/specification)

## Objectives
- [x] Expert Spec Panel review of Phase 3 specification against research goals and pathway
- [x] Identify critical issues, improvements, and gaps
- [x] Fix all identified issues in the Phase 3 specification

## Work Done

### Expert Spec Panel Review of Phase 3
- Read Phase 3 specification (full document, ~2300 lines)
- Read Pathway A research plan and validation report
- Read Phase 2.5 decision report (DCBF filter recommendation)
- Reviewed current codebase state (478 tests, 407 passing)
- Conducted multi-expert panel review (Wiegers, Fowler, Nygard, Crispin, Adzic)
- **Score**: 7.0/10 initial → estimated 8.5+/10 after fixes
- **Findings**: 3 critical, 10 high-priority, 8 medium-priority issues

### Critical Issues Fixed (C1-C3)
- **C1**: Replaced all stale CBF-Beta/BarrierNet references with PPO+DCBF post-hoc filter architecture throughout spec (Phase 2.5 decision was made AFTER spec was written)
- **C2**: Redefined safety metrics — distinguished physical collisions (target: zero) from CBF boundary violations (target: <1%), making paper claims honest and verifiable
- **C3**: Fixed impossible curriculum advancement criterion ("both agents >70%" in zero-sum game) to single pursuer capture rate >70%

### High-Priority Issues Fixed (H1-H10)
- **H1**: BiMDN pre-training data now uses mixed policies (30% Phase 2, 30% random, 40% scripted) to avoid distribution shift
- **H2**: Added DCBF integration interface showing separation of partial obs (policy input) vs true state (filter input)
- **H3**: Rewrote SimultaneousSelfPlay to be SB3-compatible with alternating rollout collection
- **H4**: Added NavigationEnv specification for cold-start (goal-reaching + fleeing)
- **H5**: Added compute plan (§8.1) with GPU hour estimates (~220-400h required)
- **H6**: MAPPO-Lagrangian elevated to primary baseline; MACPO downgraded to optional (HIGH integration risk)
- **H7**: Reduced health monitoring overhead — eval frequency 10K→50K for full suite, episodes 50→20
- **H8**: Fixed Test H to use pre-trained BiMDN instead of untrained network
- **H9**: Added 3 new tests (V: end-to-end smoke, W: DCBF+partial-obs, X: pluggable encoder)
- **H10**: Fixed Test J to be a smoke test (not asserting learning at 50K steps)

### Medium-Priority Issues Fixed (M1-M8)
- **M1**: Added pluggable encoder interface (BiMDN, LSTMEncoder, MLPHistoryEncoder) via Test X
- **M2**: Justified BiMDN RMSE thresholds (random baseline ~8.2m for 20×20 arena)
- **M3**: Added Test W for DCBF+partial-obs interface verification
- **M4**: Added Example 6 — full timestep walkthrough with tensor shapes at every stage
- **M5**: Changed FOV to be active in ALL curriculum levels (not just 3-4)
- **M6**: Updated cold-start to include flee phase alongside navigation
- **M7**: Phase splitting addressed in compute plan context
- **M8**: Made simultaneous self-play (D5/D15) optional throughout

## Files Changed
| File | Action | Description |
|------|--------|-------------|
| `docs/phases/phase3_partial_observability_selfplay.md` | Modified | 21 issues fixed across critical/high/medium priority |
| `docs/worklogs/2026-02-22_S36.md` | Created | This session worklog |

## Decisions Made
| Decision | Rationale |
|----------|-----------|
| Panel review before Phase 3 implementation | Phase 3 is the most complex phase; catching issues now saves weeks |
| Physical safety vs CBF boundary violations distinction | Makes paper claims honest — "zero collisions" is verifiable, "zero CBF violations" is not realistic |
| MAPPO-Lagrangian as primary baseline | Easy to build on SB3, MACPO has HIGH integration risk |
| FOV active in all curriculum levels | BiMDN needs partial-obs data throughout to fine-tune end-to-end |
| Mixed policy data for BiMDN pre-training | Avoids distribution shift between full-state training data and partial-obs deployment |
| Simultaneous self-play made optional | AMS-DRL (alternating) is primary; simultaneous adds complexity with unclear benefit |

## Issues & Blockers
| Issue | Resolution |
|-------|------------|
| Phase 3 spec written before Phase 2.5 DCBF decision | All CBF-Beta/BarrierNet references replaced with PPO+DCBF |
| Impossible curriculum criterion (both >70% in zero-sum) | Changed to single pursuer capture rate >70% |
| Test H tested untrained network (meaningless) | Rewrote to pre-train BiMDN before testing multimodality |
| Test J asserted learning at 50K steps (unreliable) | Changed to smoke test (no crash, finite NE gap) |
| Health monitoring overhead (15× training time) | Tiered evaluation: lightweight every 10K, full every 50K, 20 episodes |

## Next Steps
- [ ] Begin Phase 3 Session 1 implementation
- [ ] Set up partial observability wrappers (FOV, observation history)
- [ ] Implement BiMDN belief encoder architecture

## Metrics
- Documents reviewed: 5 (Phase 3 spec, Pathway A, Validation Report, Phase 2.5 Decision, Codebase structure)
- Issues identified: 21 (3 critical, 10 high, 8 medium)
- Issues fixed: 21/21
- Estimated quality improvement: 7.0 → 8.5+/10
